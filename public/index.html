<!DOCTYPE html>
<div class="row" style="margin-bottom:12px">
<div class="col card pad">
<div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:10px">
<div>
<div style="font-size:18px;font-weight:700">${r.rig_id} <span class="muted">${r.name?('· '+r.name):''}</span></div>
<div class="badges" style="margin-top:6px">${badge(m.status)} ${miner.name?`<span class='badge'>${miner.name}${miner.version?(' v'+miner.version):''}</span>`:''} ${miner.coin?`<span class='badge'>coin: ${miner.coin}</span>`:''}</div>
</div>
<div class="toolbar">
<button class="ghost" disabled title="SSH yokken pasif">İzole Et</button>
<button class="ghost" disabled title="SSH yokken pasif">OC Reset</button>
<button class="ghost" disabled title="SSH yokken pasif">Miner Restart</button>
<a class="pill" href="#">← Liste</a>
</div>
</div>


<div class="kv">
<div class="muted">Toplam Hash</div><div>${fmtMH(m.totalMHs)}</div>
<div class="muted">Toplam Güç</div><div>${fmtW(m.totalW)}</div>
<div class="muted">Verimlilik</div><div>${fmtEff(m.eff)}</div>
<div class="muted">Son Güncelleme</div><div>${fmtTimeAgo(m.delta)}</div>
</div>
</div>
<div class="col card pad">
<div style="font-weight:700;margin-bottom:8px">Uyarılar</div>
<div class="muted">${(r.warnings && r.warnings.length)? r.warnings.map(x=>`• ${x}`).join('<br>') : '—'}</div>
</div>
</div>


<div class="card" style="overflow:auto">
<table>
<thead><tr>
<th>#</th><th>Model</th><th>Temp</th><th>Fan</th><th>Power</th><th>Util</th><th>Hash</th><th>PL</th><th>Durum</th><th>İşlem</th>
</tr></thead>
<tbody>${gpuRows || '<tr><td colspan="10" class="muted">GPU verisi yok.</td></tr>'}</tbody>
</table>
</div>`;
}


function byId(id){ return RIGS.find(x => String(x.rig_id) === String(id)); }


function router(){
const hash = location.hash.replace(/^#!/,'#');
const view = document.getElementById('view');
const m = hash.match(/^#\/rig\/(.+)$/);
if(m){
const rig = byId(decodeURIComponent(m[1]));
view.innerHTML = rig ? renderDetail(rig) : '<div class="muted">Rig bulunamadı.</div>';
} else {
view.innerHTML = renderList(RIGS);
const hard = document.getElementById('hardRefresh');
hard && hard.addEventListener('click', async ()=>{ await loadAndRender(true); });
}
}


async function loadAndRender(force){
try{
const data = await fetchJSON('rigs.json' + (force? ('?cache=' + Math.random()) : ''));
RIGS = normalizeData(data);
router();
if(timer) clearTimeout(timer);
timer = setTimeout(()=>loadAndRender(false), AUTO_REFRESH_MS);
}catch(err){
document.getElementById('view').innerHTML = `<div class="muted">Veri yüklenemedi: ${err.message}</div>`;
}
}


loadAndRender(false);
</script>
</body>
</html>
